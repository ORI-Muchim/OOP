# 주식 거래 프로그램 - 3인 역할 분담

---

## 1. 팀원 A: 시장 인프라 담당

### 담당 클래스
| 클래스 | 역할 |
|--------|------|
| **Market** | 주식 시장 전체 관리 및 가격 변동 시뮬레이션 |
| **Stock** | 개별 주식의 가격과 거래량 정보 관리 |
| **Transaction** | 거래 내역 기록 및 출력 |

### 주요 구현 내용
- 주식 시장 시뮬레이션 (95% 정상 등락, 5% 블랙스완 이벤트)
- 주가 변동률 계산
- 거래량 계산 (EMA 지수이동평균 적용)
- 시장 변동성 계산 (전 종목 변동률의 표준편차)
- 거래 내역 기록 및 관리

### 핵심 알고리즘
```
시장 변동 시뮬레이션:
- 95% 확률: -2% ~ +2% (정상 등락)
- 5% 확률: -10% ~ -30% (블랙 스완 이벤트)

평균 거래량 (EMA):
averageVolume = averageVolume × 0.95 + newVolume × 0.05

시장 변동성:
volatility = √(Σ(각 종목 변동률 - 평균 변동률)² / N)
```

### 난이도: 중간
### 의존성: 없음 (기반 모듈)

---

## 2. 팀원 B: 트레이더 및 거래 담당

### 담당 클래스
| 클래스/구조체 | 역할 |
|---------------|------|
| **Trader** | 투자자의 포트폴리오 관리 및 매매 실행 |
| **Position** | 보유 주식의 수량과 매수 정보 관리 (구조체) |

### 주요 구현 내용
- 포트폴리오 관리 (일반 포지션 / 갭 포지션)
- 매수/매도 로직 구현
- 갭 포지션 청산 로직
- 총 자산 가치 계산
- 수익률 계산

### 핵심 함수
| 함수명 | 설명 |
|--------|------|
| buy() | 일반 매수 (성공/실패 반환) |
| sell() | 일반 매도 (성공/실패 반환) |
| buyGapPosition() | 폭락장 매수 |
| closeGapPosition() | 특정 갭 포지션 청산 |
| closeAllGapPositions() | 폭락장 포지션 전량 청산 |
| getTotalAssetValue() | 총 자산 가치 계산 |
| getGapPositionProfit() | 갭 포지션 수익률 계산 |

### 거래 처리 흐름
```
매수: buy() 호출 → 잔고 확인 → Stock 가격 조회 → Transaction 생성
      → Market에 등록 → Portfolio 업데이트 → 현금 차감

매도: sell() 호출 → 보유 수량 확인 → Stock 가격 조회 → Transaction 생성
      → Market에 등록 → Portfolio 업데이트 → 현금 증가
```

### 난이도: 중-고
### 의존성: 팀원 A의 Market, Stock, Transaction 필요

---

## 3. 팀원 C: 시장 분석 및 전략 담당

### 담당 클래스
| 클래스 | 역할 |
|--------|------|
| **DisruptionDetector** | 시장 위험도 분석 및 투자 전략 결정 |
| **MarketState** (추상) | 시장 상태의 기본 인터페이스 (State Pattern) |
| **NormalState** | 정상 시장 상태 전략 |
| **DisruptedState** | 폭락 시장 상태 전략 |

### 주요 구현 내용
- 위험도 점수 계산
- State Pattern 구현 (상태 전환 로직)
- 역발상 매수 전략 구현
- 갭 포지션 목표 수익률 청산

### 핵심 알고리즘
```
위험도 계산:
DisruptionScore = (현재거래량 / 평균거래량) × 변동성 × 1000

상태 판단:
- Score > 70.0 → DisruptedState 전환
- Score < 50.0 → NormalState 복귀
- 50.0 ≤ Score ≤ 70.0 → 현재 상태 유지
```

### 역발상 매수 전략 (DisruptedState)
| 조건 | 값 |
|------|-----|
| 가격 하락률 | < -15% |
| 거래량 | > 평균 거래량 × 200% |
| 현재 갭 포지션 수 | < 3개 |

### 갭 포지션 청산 조건 (NormalState)
| 조건 유형 | 세부 내용 |
|----------|----------|
| 목표 수익 달성 | 수익률 ≥ 10% 시 해당 포지션 청산 |
| 시장 정상화 | Score < 50.0 상태에서 수익 포지션 순차 청산 |

### 난이도: 고
### 의존성: 팀원 A의 Market, 팀원 B의 Trader 필요

---

## 4. 개발 순서 권장

```
┌─────────────────────────────────────────────────────────────┐
│  Phase 1: 팀원 A                                            │
│  - Market, Stock, Transaction 클래스 구현                    │
│  - 기반 인프라 완성                                          │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  Phase 2: 팀원 B + 팀원 C (병렬 작업)                        │
│  - B: Position, Trader 기본 기능                            │
│  - C: MarketState, NormalState, DisruptedState              │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  Phase 3: 팀원 B + C 협업                                   │
│  - DisruptionDetector 구현                                   │
│  - autoTrade() 연동                                          │
└─────────────────────────────────────────────────────────────┘
                              ↓
┌─────────────────────────────────────────────────────────────┐
│  Phase 4: 전체 통합                                         │
│  - main() 함수 작성                                          │
│  - 통합 테스트                                               │
└─────────────────────────────────────────────────────────────┘
```

---

## 5. 작업량 비교

| 팀원 | 클래스 수 | 예상 함수 수 | 복잡도 |
|------|----------|-------------|--------|
| A (시장 인프라) | 3개 | ~15개 | 중 |
| B (트레이더) | 2개 | ~12개 | 중-고 |
| C (분석/전략) | 4개 | ~15개 | 고 |

> 팀원 C가 클래스 수는 많지만, NormalState/DisruptedState는 MarketState 상속으로 구조가 유사하여 실제 작업량은 균형이 맞습니다.

---

## 6. 공통 협의 사항

| 항목 | 내용 |
|------|------|
| 헤더 파일 | 인터페이스(헤더)를 먼저 정의 후 공유 |
| 메모리 관리 | unique_ptr 사용 규칙 통일 |
| 코딩 컨벤션 | 변수명, 함수명 규칙 통일 |
| main() 함수 | 테스트 시나리오 함께 작성 |
| Git 브랜치 | 각자 브랜치에서 작업 후 머지 |

---

## 7. 메모리 관리 주의사항

| 클래스 | 포인터 타입 | 관리 방식 |
|--------|-----------|----------|
| Market → Stock | vector<Stock*> | Market 소멸자에서 delete |
| Trader → DisruptionDetector | unique_ptr | 자동 해제 |
| DisruptionDetector → MarketState | unique_ptr | changeState() 시 자동 교체 |
| Position → Stock | Stock* (약한 참조) | 해제 책임 없음 (Market 소유) |

**주의:** Position 내의 Stock 포인터는 Market이 소유한 객체를 참조만 하므로, Position에서 delete하면 안됩니다.

---

## 8. 클래스 관계도 요약

```
                    ┌─────────────┐
                    │   Trader    │
                    └──────┬──────┘
                           │ has-a
              ┌────────────┼────────────┐
              │            │            │
              ▼            ▼            ▼
        ┌──────────┐ ┌──────────┐ ┌───────────────────┐
        │ Position │ │ Position │ │ DisruptionDetector│
        │(portfolio)│ │  (gap)   │ └─────────┬─────────┘
        └──────────┘ └──────────┘           │ owns
                                            ▼
                                   ┌─────────────────┐
                                   │  <<abstract>>   │
                                   │  MarketState    │
                                   └────────┬────────┘
                                            │
                              ┌─────────────┴─────────────┐
                              │                           │
                              ▼                           ▼
                       ┌─────────────┐           ┌──────────────┐
                       │ NormalState │           │DisruptedState│
                       └─────────────┘           └──────────────┘

        ┌─────────────┐
        │   Market    │
        └──────┬──────┘
               │ contains
       ┌───────┴───────┐
       │               │
       ▼               ▼
  ┌─────────┐   ┌─────────────┐
  │  Stock  │   │ Transaction │
  └─────────┘   └─────────────┘
```

---

*작성일: 2025-12-01*
